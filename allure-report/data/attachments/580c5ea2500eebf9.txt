# Instructions

- Following Playwright test failed.
- Explain why, be concise, respect Playwright best practices.
- Provide a snippet of code with the fix, if possible.

# Test info

- Name: POST Books >> has 200 response code
- Location: C:\Users\dimitar.stoev\Desktop\interview framework\AllWynPlaywright\project-root\tests\get-books.spec.ts:128:9

# Error details

```
Error: expect(received).toBe(expected) // Object.is equality

Expected: 200
Received: 400
    at C:\Users\dimitar.stoev\Desktop\interview framework\AllWynPlaywright\project-root\tests\get-books.spec.ts:129:33
```

# Test source

```ts
   29 | //       data = await response.json(); // 🔥 важно!
   30 | //       console.log('⚙️ response:', response,data);
   31 | //     });    
   32 |
   33 | //     test('has 200 response code', async () => {
   34 | //       expect(response.status()).toBe(200);
   35 | //     });
   36 |
   37 | //     test('has response data as a non-empty array', async () => {
   38 | //       expect(Array.isArray(data)).toBe(true);
   39 | //       expect(data.length).toBeGreaterThan(0);
   40 | //     });
   41 | //   });
   42 |
   43 |   // GET book by ID
   44 |   // test.describe(`${Method.GET} ${endpoint} by ID`, () => {
   45 |   //   let api: BaseApi;
   46 |   //   let repository: BooksApi;
   47 |   //   let response;
   48 |   //   let existingBook;
   49 |
   50 |   //   test.beforeAll(async () => {
   51 |   //     api = new BaseApi();
   52 |   //     await api.initContext();
   53 |
   54 |   //     repository = new BooksApi();
   55 |   //     const books = repository.loadBooks();
   56 |   //     expect(books.length).toBeGreaterThan(0);
   57 |   //     existingBook = books[0];
   58 |
   59 |   //     const config = api.buildRequestConfiguration(Method.GET, endpoint, { id: existingBook.id });
   60 |   //     response = await api.sendRequest(config);
   61 |   //   });
   62 |
   63 |   //   test('has 200 response code', async () => {
   64 |   //     expect(response.status()).toBe(200);
   65 |   //   });
   66 |
   67 |   //   test('has all fields matching existing book', async () => {
   68 |   //     const data = await response.json();
   69 |   //     for (const key of Object.keys(existingBook)) {
   70 |   //       if (key === 'id' || key==='title') {; // После може да направя датата да се подава динамично в джейсъна
   71 |   //       expect(data[key]).toBe(existingBook[key]);
   72 |   //       }
   73 |   //       const actualKeys = Object.keys(data).sort();
   74 |   //       const expectedKeys = Object.keys(existingBook).sort();
   75 |       
   76 |   //       expect(actualKeys).toEqual(expectedKeys);
   77 |   //     }
   78 |   //   });
   79 |   // });
   80 |
   81 | //   // GET book by non-existing ID
   82 | //   test.describe(`${Method.GET} ${endpoint} by non-existing ID`, () => {
   83 | //     let api: BaseApi;
   84 | //     let response;
   85 |
   86 | //     test.beforeAll(async () => {
   87 | //       api = new BaseApi();
   88 | //       await api.initContext();
   89 |
   90 | //       const config = api.buildRequestConfiguration(Method.GET, endpoint, { id: -999 });
   91 | //       response = await api.sendRequest(config);
   92 | //     });
   93 |
   94 | //     test('has 404 response code', async () => {
   95 | //       expect(response.status()).toBe(404);
   96 | //     });
   97 | //   });
   98 |
   99 | //   // POST create new book
  100 |   test.describe(`${Method.POST} ${endpoint}`, () => {
  101 |     let api: BaseApi;
  102 |     let repository: BooksApi;
  103 |     let response;
  104 |     let payload;
  105 |     let data;
  106 |
  107 |     test.beforeAll(async () => {
  108 |       api = new BaseApi();
  109 |       await api.initContext();
  110 |
  111 |       repository = new BooksApi();
  112 |       payload = repository.generateBookPayload();
  113 | console.log('📦 Payload:\n', JSON.stringify(payload, null, 2));
  114 | const config = api.buildRequestConfiguration(Method.POST, endpoint, {
  115 |   payload: {
  116 |     "id": 0,
  117 |     "title": "string",
  118 |     "description": "string",
  119 |     "pageCount": 0,
  120 |     "excerpt": "string",
  121 |     "publishDate": "2025-04-07T15:45:00.000Z"
  122 |   }
  123 | });
  124 |       response = await api.sendRequest(config);
  125 |       data = await response.json();
  126 |     });
  127 |
  128 |     test('has 200 response code', async () => {
> 129 |       expect(response.status()).toBe(200);
      |                                 ^ Error: expect(received).toBe(expected) // Object.is equality
  130 |     });
  131 |
  132 |     test('has response data with valid id', async () => {
  133 |       expect(data.id).toBeGreaterThan(0);
  134 |     });
  135 |
  136 |     test('has response data matching payload', async () => {
  137 |       for (const key of Object.keys(payload)) {
  138 |         expect(data[key]).toBe(payload[key]);
  139 |       }
  140 |     });
  141 |   });
  142 |
  143 | //   // PUT update existing book
  144 | //   test.describe(`${Method.PUT} ${endpoint} by ID`, () => {
  145 | //     let api: BaseApi;
  146 | //     let repository: BooksApi;
  147 | //     let response;
  148 | //     let updatedPayload;
  149 |
  150 | //     test.beforeAll(async () => {
  151 | //       api = new BaseApi();
  152 | //       await api.initContext();
  153 |
  154 | //       repository = new BooksApi();
  155 | //       const existingBook = repository.loadBooks()[0];
  156 |
  157 | //       updatedPayload = repository.generateBookPayload({
  158 | //         id: existingBook.id,
  159 | //         title: 'Updated Title'
  160 | //       });
  161 |
  162 | //       const config = api.buildRequestConfiguration(Method.PUT, endpoint, {
  163 | //         id: existingBook.id,
  164 | //         payload: updatedPayload
  165 | //       });
  166 |
  167 | //       response = await api.sendRequest(config);
  168 | //     });
  169 |
  170 | //     test('has 200 response code', async () => {
  171 | //       expect(response.status()).toBe(200);
  172 | //     });
  173 |
  174 | //     test('has updated title in response', async () => {
  175 | //       const data = await response.json();
  176 | //       expect(data.title).toBe(updatedPayload.title);
  177 | //     });
  178 | //   });
  179 |
  180 | //   // DELETE book by ID
  181 | //   test.describe(`${Method.DELETE} ${endpoint} by ID`, () => {
  182 | //     let api: BaseApi;
  183 | //     let repository: BooksApi;
  184 | //     let response;
  185 | //     let createdBookId;
  186 |
  187 | //     test.beforeAll(async () => {
  188 | //       api = new BaseApi();
  189 | //       await api.initContext();
  190 |
  191 | //       repository = new BooksApi();
  192 | //       const bookToDelete = repository.generateBookPayload();
  193 |
  194 | //       const postConfig = api.buildRequestConfiguration(Method.POST, endpoint, { payload: bookToDelete });
  195 | //       const postResponse = await api.sendRequest(postConfig);
  196 | //       const createdBook = await postResponse.json();
  197 | //       createdBookId = createdBook.id;
  198 |
  199 | //       const deleteConfig = api.buildRequestConfiguration(Method.DELETE, endpoint, { id: createdBookId });
  200 | //       response = await api.sendRequest(deleteConfig);
  201 | //     });
  202 |
  203 | //     test('has 200 response code', async () => {
  204 | //       expect(response.status()).toBe(200);
  205 | //     });
  206 |
  207 | //     test('book is no longer retrievable', async () => {
  208 | //       const getConfig = api.buildRequestConfiguration(Method.GET, endpoint, { id: createdBookId });
  209 | //       const getResponse = await api.sendRequest(getConfig);
  210 | //       expect(getResponse.status()).toBe(404);
  211 | //     });
  212 | //   });
  213 | // });
  214 |
```